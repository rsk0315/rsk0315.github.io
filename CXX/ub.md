# æ°—ä»˜ãã«ãã„ C++ æœªå®šç¾©å‹•ä½œãŸã¡
ã‚ã‚‹ç¨‹åº¦ã¯ C++ ã‚’æ›¸ã„ãŸçµŒé¨“ãŒã‚ã‚‹ãŒï¼Œè©³ã—ã„ä»•æ§˜ãªã©ã¯çŸ¥ã‚‰ãªã„äººã‚’èª­è€…å±¤ã¨ã—ã¦æƒ³å®šã—ã¦æ›¸ãã¤ã‚‚ã‚Šã§ã™ï¼
å¤šãã®ç«¶ãƒ—ãƒ­-er ã¯å½“ã¦ã¯ã¾ã‚‹ã¨æ€ã„ã¾ã™ï¼

@[url:http://github.com/cplusplus/draft/papers]@ ã§è¦‹ã‚‰ã‚Œã‚‹ãƒ‰ãƒ©ãƒ•ãƒˆã‚’å‚è€ƒã«ã—ã¦æ›¸ã„ã¦ã„ã¾ã™ãŒï¼Œã‚ãã¾ã§ãƒ‰ãƒ©ãƒ•ãƒˆãªã®ã§æ”¹è¨‚ã•ã‚ŒãŸã‚Šã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã™ï¼

å‡ºå…¸ã‚’ç¤ºã™éš›ã¯ï¼Œç« ç•ªå·ã‚„ãã‚Œã«æº–ãšã‚‹ç•ªå·ã¯ç‰ˆã«ã‚ˆã£ã¦å‰å¾Œã—ã†ã‚‹ã®ã§ï¼Œã‚¿ã‚°ï¼Ÿï¼ˆ[intro.scope] ã¨ã‹ [defns.argument.macro] ã®ã‚ˆã†ãªã‚‚ã®ï¼æ­£ã—ã„å‘¼ã³æ–¹ã‚’çŸ¥ã‚ŠãŸã„ï¼‰ã‚’åˆ©ç”¨ã—ã‚ˆã†ã¨æ€ã£ã¦ã„ã¾ã™ï¼

## ã¾ãšã¯ç”¨èªã‹ã‚‰
ã€Œå‡¦ç†ç³»å®šç¾©ã€ã€Œæœªè¦å®šã€ã€Œæœªå®šç¾©ã€ãªã©ã®èªã®åŒºåˆ¥ã‚’çŸ¥ã‚‰ãšï¼Œã²ã¨ã¾ã¨ã‚ã«ã€Œç’°å¢ƒä¾å­˜ã€ãªã©ã¨è¨€ã£ã¦ã„ã‚‹äººã‚’ãã‚Œãªã‚Šã«è¦‹ã‹ã‘ã‚‹ã®ã§ï¼Œãã®å®šç¾©ã‹ã‚‰ç¢ºèªã—ã¾ã™ï¼

### å‡¦ç†ç³»å®šç¾©
å‡¦ç†ç³»å®šç¾©ã®å‹•ä½œï¼ˆimplementation-defined behaviorï¼‰ã¯ï¼Œwell-formed ãªãƒ—ãƒ­ã‚°ãƒ©ãƒ æ§‹æˆãŠã‚ˆã³æ­£ã—ã„ãƒ‡ãƒ¼ã‚¿ã«ã‚ˆã‚‹å‹•ä½œã§ï¼Œå‡¦ç†ç³»ã«ä¾å­˜ã™ã‚‹ã‚‚ã®ã§ã™ï¼å„ã€…ã®å‡¦ç†ç³»ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚ˆã£ã¦ï¼ãã®å‹•ä½œã¯è¦å®šã•ã‚Œã¾ã™ï¼ˆ[defns.impl.defined]ï¼‰.

### æœªè¦å®š
æœªè¦å®šã®å‹•ä½œï¼ˆunspecified behaviorï¼‰ã¯ï¼Œwell-formed ãªãƒ—ãƒ­ã‚°ãƒ©ãƒ æ§‹æˆãŠã‚ˆã³æ­£ã—ã„ãƒ‡ãƒ¼ã‚¿ã«ã‚ˆã‚‹å‹•ä½œï¼Œå‡¦ç†ç³»ã«ä¾å­˜ã™ã‚‹ã‚‚ã®ã§ã™ï¼ã©ã®ã‚ˆã†ãªå‹•ä½œã‹ã‚’ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ç¤ºã™å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ï¼ˆ[defns.unspecified]ï¼‰.

### æœªå®šç¾©
æœªå®šç¾©å‹•ä½œï¼ˆundefined behaviorï¼‰ã¯ï¼Œè¦æ ¼æ›¸ãŒä½•ã®è¦æ±‚ã‚‚ã—ãªã„å‹•ä½œã§ã™ï¼
è¦æ ¼æ›¸ã§æ˜ç¤ºçš„ã«å®šç¾©ãŒç¤ºã•ã‚Œã¦ã„ãªã„å ´åˆã‚„ï¼Œãƒ—ãƒ­ã‚°ãƒ©ãƒ æ§‹æˆã‚„ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ããªã„å ´åˆã‚‚æœªå®šç¾©å‹•ä½œã§ã‚ã‚‹ã¨ã•ã‚Œã¾ã™ï¼

æœªå®šç¾©å‹•ä½œã¨ã—ã¦è¨±å®¹ã•ã‚Œã‚‹å‹•ä½œã¯æ¬¡ã®ã‚ˆã†ãªã‚‚ã®ã§ã™ï¼ï¼ˆã“ã‚Œã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ç›®ç·šã§èª­ã‚€ã¨ã„ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼ï¼‰
- ãã®ã‚ˆã†ãªçŠ¶æ³ã‚’å®Œå…¨ã«ç„¡è¦–ã—ã¦äºˆæœŸã—ãªã„çµæœã‚’æ‹›ã‹ã›ã‚‹
- ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ãƒ»å®Ÿè¡Œæ™‚ã«ç’°å¢ƒã«å¿œã˜ã¦æ–‡æ›¸åŒ–ã•ã‚ŒãŸã‚ˆã†ã«å‹•ä½œã™ã‚‹ï¼ˆè¨ºæ–­ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ãªãã¦ã‚ˆã„ï¼‰
- ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚„å®Ÿè¡Œã‚’çµ‚äº†ã•ã›ã‚‹ï¼ˆè¨ºæ–­ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚ã‚Šï¼‰

ï¼ˆ[defns.undefined]ï¼‰

ã–ã£ãã‚Šè¨€ã†ã¨ï¼Œ
- å‡¦ç†ç³»å®šç¾©ãƒ»æœªè¦å®šã¯ã‚»ãƒ¼ãƒ•
- æœªå®šç¾©ã¯ã‚¢ã‚¦ãƒˆ
- ã€Œç’°å¢ƒä¾å­˜ã€ã¨ã„ã†åˆ†é¡ã¯ãªã„

ã§ã™ï¼

æœªå®šç¾©å‹•ä½œã‚’èµ·ã“ã—ã†ã‚‹ã‚³ãƒ¼ãƒ‰ãŒãŸã¾ãŸã¾æœŸå¾…ã©ãŠã‚Šã«å‹•ã„ãŸå ´åˆã§ã‚‚ï¼Œãã‚Œã¯ã€Œã‚³ãƒ¼ãƒ‰ãŒæ­£ã—ã„ã€ã“ã¨ã‚’ç¤ºã™ç†ç”±ã«ã¯ãªã‚‰ãªã„ã“ã¨ã‚‚è¦šãˆã¦ãŠãã¾ã—ã‚‡ã†ï¼

## ä¾‹ï¼ˆå‡¦ç†ç³»å®šç¾©ãƒ»æœªè¦å®šï¼‰
ä¾‹ã‚’æŒ™ã’ã¦ãŠãã¨åˆ†ã‹ã‚Šã‚„ã™ã„ã‹ã‚‚ã—ã‚Œãªã„ã®ã§ä¾‹ã‚’æŒ™ã’ã¾ã™ï¼
å…·ä½“çš„ã«ä½•ãŒã€Œå‡¦ç†ç³»å®šç¾©ã€ã§ä½•ãŒã€Œæœªè¦å®šã€ã‹ã¯åŒºåˆ¥ã—ã¦è¦šãˆã¦ãŠãå¿…è¦ã¯ç„¡ã„ã¨æ€ã„ã¾ã™ï¼

- `sizeof(int)` ãªã©ã®å€¤ã¯å‡¦ç†ç³»å®šç¾©ã§ã™ï¼ˆ[expr.sizeof]ï¼‰
- `E1 >> E2` ã«ãŠã„ã¦ `E1` ãŒè² ã®å ´åˆã®å€¤ã¯å‡¦ç†ç³»å®šç¾©ã§ã™ï¼ˆ[expr.shift]ï¼‰
- `char` ãŒç¬¦å·ã¤ãã‹ã©ã†ã‹ã¯å‡¦ç†ç³»å®šç¾©ã§ã™ï¼ˆ[dcl.type.simple]ï¼‰
- `"foo" == "foo"` ãŒ `true` ã‹ã©ã†ã‹ã¯æœªè¦å®šã§ã™ï¼ˆ[lex.string]ï¼‰
- æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®é–¢æ•°ãŒ `inline` ã‹ã©ã†ã‹ã¯æœªè¦å®šã§ã™ï¼ˆ[global.functions] ãŠã‚ˆã³ [member.functions]ï¼‰
- `std::complex` ã‚’ `float`ï¼Œ`double`ï¼Œ`long double` ä»¥å¤–ã§å®Ÿä½“åŒ–ã—ãŸå ´åˆã®å‹•ä½œã¯æœªè¦å®šã§ã™ï¼ˆ[complex.numbers]ï¼‰


## ä¾‹ï¼ˆæœªå®šç¾©ï¼‰
æœªå®šç¾©å‹•ä½œã®ä¾‹ã‚’æŒ™ã’ã¾ã™ï¼

ä½•ãŒã©ã†ã¾ãšã„ã‹è€ƒãˆã¦ã‚‚ã‚‰ã†ãŸã‚ï¼Œå…ˆã«ã‚³ãƒ¼ãƒ‰ã¨å®Ÿè¡Œä¾‹ã‚’ç¤ºã—ã¦ã‹ã‚‰è§£èª¬ã‚’å…¥ã‚Œã‚‹å½¢å¼ã«ã—ã¾ã™ï¼
*æœªå®šç¾©å‹•ä½œ*ãªã®ã§ï¼Œæ‰‹å…ƒã§åŒã˜ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã—ãŸå ´åˆã«å¿…ãšã—ã‚‚åŒã˜å‹•ä½œãŒå†ç¾ã™ã‚‹ã¨ã¯é™ã‚‰ãªã„ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ï¼åŒã˜ç’°å¢ƒã§ã‚ã£ã¦ã‚‚ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãªã©ã«ã‚ˆã£ã¦å‹•ä½œãŒå¤‰ã‚ã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ï¼

### é…åˆ—å¢ƒç•Œå¤–å‚ç…§
#`[sample.cpp]
#include <cstdio>

int main() {
  int a[5]={31, 41, 59, 26, 53}, x=58;
  for (int i=0; i<=5; ++i)
    if (a[i] == x) return !printf("Found!\n");
}
#`
#_
$ g++ -O2 sample.cpp
$ ./a.out
- Found!
#_
ã“ã‚Œã¯æ¯”è¼ƒçš„æœ‰åãªä¾‹ã§ã™ã­ï¼ä»¥ä¸‹ã®ã‚ˆã†ã«èª¬æ˜ã•ã‚Œã¾ã™ï¼
1. `a[5]` ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã¯ãªã„ã¨ä»®å®šã§ãã‚‹
2. `i` ãŒ `5` ã«åˆ°é”ã™ã‚‹å‰ã«ãƒ«ãƒ¼ãƒ—ã‚’æŠœã‘ã‚‹ã“ã¨ã«ãªã‚‹
3. `return !printf("Found!\n");` ã‚’å®Ÿè¡Œã§ãã‚‹

é…åˆ—ã®å¢ƒç•Œã‚’è¶…ãˆã¦ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸå ´åˆã«å¿…ãš Segfault ãŒèµ·ãã‚‹ã¨æ€ã£ã¦ã„ã‚‹äººã¯ã„ã¾ã›ã‚“ã‹ï¼Ÿ ãã‚Œã¯å‹˜é•ã„ã§ã‚ã‚‹ã¨æ—©ã‚ã«æ°—ä»˜ã„ã¦ãŠãã¾ã—ã‚‡ã†ï¼

### è­˜åˆ¥å­
#`[sample.cpp]
#define _STDIO_H
#include <cstdio>

int main() {
  printf("Hello, world.\n");
}
#`

#_
$ g++ sample.cpp
- In file included from [01msample.cpp:2[m:
- [01m/usr/include/c++/8.2.0/cstdio:98:11:[m [01;31merror: [mâ€˜[01m::FILE[mâ€™ has not been declared
-    using ::[01;31mFILE[m;
-            [01;31m^~~~[m
- [01m/usr/include/c++/8.2.0/cstdio:99:11:[m [01;31merror: [mâ€˜[01m::fpos_t[mâ€™ has not been declared
-    using ::[01;31mfpos_t[m;
-            [01;31m^~~~~~[m
- ...
- [01msample.cpp:[m In function â€˜[01mint main()[mâ€™:
- [01msample.cpp:5:3:[m [01;31merror: [mâ€˜[01mprintf[mâ€™ was not declared in this scope
-    [01;31mprintf[m("Hello, world.\n");
-    [01;31m^~~~~~[m
- [01msample.cpp:5:3:[m [01;36mnote: [mâ€˜[01mprintf[mâ€™ is defined in header â€˜[01m<cstdio>[mâ€™; did you forget to â€˜[01m#include <cstdio>[mâ€™?
- [01msample.cpp:3:1:[m
- +[32m#include <cstdio>[m
-
- [01msample.cpp:5:3:[m
-    [01;36mprintf[m("Hello, world.\n");
-    [01;36m^~~~~~[m
#_

ãŸã ã® Hello, world ã§ã™ãŒï¼Œã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãŒé€šã‚Šã¾ã›ã‚“ï¼
`_STDIO_H` ã‚’ `#define` ã—ãŸã“ã¨ã«ã‚ˆã‚‹å½±éŸ¿ãªã®ã¯æ˜ç™½ã§ã™ãŒï¼Œãªãœã“ã‚ŒãŒã‚ˆããªã„ã‹ã‚’èª¬æ˜ã§ãã¾ã™ã‹ï¼Ÿ

å…·ä½“çš„ã«ã¯ï¼Œä»¥ä¸‹ã®è­˜åˆ¥å­ã¯å‡¦ç†ç³»ã«äºˆç´„ã•ã‚Œã¦ã„ã¦ï¼Œå‡¦ç†ç³»ãŒè‡ªç”±ã«ä½¿ã£ã¦ã„ã„ï¼ˆãƒ—ãƒ­ã‚°ãƒ©ãƒãŒä½¿ã‚ãªã„ã¨ä»®å®šã—ã¦ã„ã„ï¼‰ã“ã¨ã«ãªã£ã¦ã„ã¾ã™ï¼ˆ[lex.name]ï¼‰ï¼
- ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã§å§‹ã¾ã‚‹ï¼ˆ`_.*`ï¼‰
  - ã“ã‚Œã¯ã‚°ãƒ­ãƒ¼ãƒãƒ«åå‰ç©ºé–“ã®ã¿
- é€£ç¶šã™ã‚‹ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã‚’å«ã‚€ï¼ˆ`.*__.*`ï¼‰
- ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã«ç¶šãå¤§æ–‡å­—ã§å§‹ã¾ã‚‹ï¼ˆ`_[A-Z].*`ï¼‰

ä»Šå›ã® `_STDIO_H` ã¯ã“ã‚Œã®ä¸€ã¤ã‚ï¼ˆãŠã‚ˆã³ä¸‰ã¤ã‚ï¼‰ã«æŠµè§¦ã—ã¦ã„ã¾ã™ï¼

### æ¯”è¼ƒé–¢æ•°
#`[sample.cpp]
#include <cstdio>
#include <vector>

int main() {
  int a[512]={};
  std::sort(a, a+512, [](int, int) { return true; });
}
#`
#_
$ g++ sample.cpp
$ ./a.out
- Segmentation fault (core dumped)
#_

å˜ç´”ãªã‚½ãƒ¼ãƒˆã§ã™ãŒï¼ŒSegfault ã«ãªã£ã¦ã—ã¾ã£ãŸã®ã¯ãªãœã§ã—ã‚‡ã†ï¼Ÿ
`std::sort`ï¼ˆãªã©ï¼‰ã§ã¯æ¯”è¼ƒé–¢æ•°ã¯ä»¥ä¸‹ã®æ€§è³ªï¼ˆstrict weak orderingï¼‰ã‚’æº€ãŸã™å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼ˆ[alg.sorting]ï¼‰ï¼
- ã™ã¹ã¦ã® `a` ã«ã¤ã„ã¦ `!(a < a)`
- `a < b` ãªã‚‰ã° `!(b < a)`
- `a < b` ã‹ã¤ `b < c` ãªã‚‰ã° `a < c`

ä»Šå›ã¯ã“ã‚Œã‚’æº€ãŸã•ãªã‹ã£ãŸãŸã‚ï¼ŒäºˆæœŸã—ãªã„çµæœã¨ãªã‚Šã¾ã—ãŸï¼
æœ€é©åŒ–ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã‚‹ã¨ï¼ŒSegfault ã«ãªã£ã¦ãã‚Œãšã«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒçµ‚äº†ã—ãªããªã£ãŸã‚Šã—ã¾ã™ï¼

### ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼
#`[sample.cpp]
#include <cstdio>

int main() {
  int x;
  scanf("%d", &x);
  if (x < 0 && -x < 0) printf("-2147483648\n");
}
#`
#_
$ g++ sample.cpp
$ ./a.out <<< -2147483648  # no output
#_
ä»Šã¯ `int` ã¯ 32-bit ã§è² æ•°ã¯ 2 ã®è£œæ•°ã§è¡¨ç¾ã™ã‚‹å‡¦ç†ç³»ã‚’ä»®å®šã—ã¾ã™ï¼

`-(-2147483648)` ã‚’æ‰‹é †ã©ãŠã‚Šã«è¨ˆç®—ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ï¼Œä»¥ä¸‹ã®ã‚ˆã†ã« `-2147483648` ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ï¼
- `0x80000000` ã‚’ãƒ“ãƒƒãƒˆåè»¢ã—ã¦ `0x7FFFFFFF` ã‚’å¾—ã‚‹
- `0x7FFFFFFF` ã« `1` ã‚’è¶³ã—ã¦ `0x80000000` ã‚’å¾—ã‚‹

ãã®ãŸã‚ï¼Œä¸Šã®çŠ¶æ³ã§ã¯ `x < 0` ã‚‚ `-x < 0` ã‚‚ `true` ã¨ãªã‚‹ã‚ˆã†ã«æ€ã‚ã‚Œã¾ã™ã­ï¼
å®Ÿéš›ã¯ï¼Œ*ç¬¦å·ã¤ã*æ•´æ•°å‹ãŒã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã—ãŸã¨ãã®å‹•ä½œã¯æœªå®šç¾©ã¨ãªã£ã¦ã„ã¾ã™ï¼ˆ[expr.pre]ï¼‰ï¼
ãã®ãŸã‚ï¼Œä»Šå›ã¯ãã†ãªã‚‹çŠ¶æ³ã¯ç„¡è¦–ã•ã‚Œã¦ä½•ã‚‚å‡ºåŠ›ã›ãšã«çµ‚äº†ã™ã‚‹ã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸï¼ˆ`x` ãŒä»–ã®ã©ã®å€¤ã§ã‚‚ `x < 0 && -x < 0` ã¯ `true` ã«ãªã‚Šãˆãªã„ã“ã¨ã«æ³¨æ„ï¼‰ï¼

ãªãŠï¼Œ$n$ãƒ“ãƒƒãƒˆã®*ç¬¦å·ãªã—*æ•´æ•°å‹ã¯ $2^n$ ã‚’æ³•ã¨ã—ãŸæ¼”ç®—ã‚’è¡Œã†ãŸã‚ï¼Œå®Ÿè³ªçš„ã«ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã—ãªã„ï¼ˆãã®å‹ã§è¡¨ã›ã‚‹ç¯„å›²ã‚’è¶…ãˆãŸå€¤ã«ãªã‚‰ãªã„ï¼‰ã¨ã•ã‚Œã¦ã„ã¾ã™ï¼ˆ[basic.fundamental]ï¼‰ï¼


## å¯¾ç­–
æœªå®šç¾©ãªã‚³ãƒ¼ãƒ‰ã‚’å„ãƒ—ãƒ­ã‚°ãƒ©ãƒãŒæ‚ªã„ã¨ã¯ã„ãˆï¼Œã„ãã‚‰ã‹ã¯å‡¦ç†ç³»ã«æ¤œçŸ¥ã—ã¦ã»ã—ã„ã‚‚ã®ã§ã™ã‚ˆã­ï¼

### `_GLIBCXX_DEBUG`
GCC ã«ãŠã„ã¦ã¯ï¼Œ`_GLIBCXX_DEBUG` ã‚’ `#define` ã™ã‚‹ã“ã¨ã§ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦ãã‚Œã¾ã™ï¼

ã“ã®è­˜åˆ¥å­ã¯ï¼Œå‰è¿°ã®é€šã‚Šå‡¦ç†ç³»ã«äºˆç´„ã•ã‚ŒãŸã‚‚ã®ã§ã™ï¼
C++ ã®è¦æ ¼ã§å®šã‚ã‚‰ã‚ŒãŸæ©Ÿèƒ½ã§ã¯ãªã„ã®ã§ï¼Œåˆ¥ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã§ã“ã‚Œã‚’è¡Œã„ãŸã„ã¨ãã¯ï¼Œã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼
GCC ã§ã¯ã¡ã‚ƒã‚“ã¨ @[url:https://gcc.gnu.org/onlinedocs/libstdc++/manual/using_macros.html]æ–‡æ›¸åŒ–@ ã•ã‚Œã¦ã„ã¾ã™ï¼

ãŸã¨ãˆã°ï¼Œä»¥ä¸‹ã®ã‚ˆã†ã«æ•™ãˆã¦ãã‚Œã¾ã™ï¼
#`[sample.cpp]
// #define _GLIBCXX_DEBUG  /* ã‚½ãƒ¼ã‚¹å†…ã§ #define ã—ã¦ã‚‚ã„ã„ */
#include <cstdio>
#include <vector>

int main() {
  std::vector<int> x{1, 2};
  printf("%d\n", x[2]);
}
#`
#_
$ g++ -D_GLIBCXX_DEBUG sample.cpp  # ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã« #define ã—ã¦ã‚‚ã„ã„
$ ./a.out
- /usr/include/c++/8.2.0/debug/vector:417:
- Error: attempt to subscript container with out-of-bounds index 2, but 
- container only holds 2 elements.
- 
- Objects involved in the operation:
-     sequence "this" @ 0x0x7ffc383c92c0 {
-       type = std::__debug::vector<int, std::allocator<int> >;
-     }
- Aborted (core dumped)
#_
`std::vector` ã®ä»£ã‚ã‚Šã« `__gnu_debug::vector`ï¼ˆ`std::__debug::vector`ï¼Ÿï¼‰ã‚’ä½¿ã£ã¦æ§˜ã€…ãªãƒã‚§ãƒƒã‚¯ã‚’è¡Œã£ã¦ãã‚Œã¾ã™ï¼
å°‘ã€…åˆ†ã‹ã‚Šã«ãã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒï¼Œã‚¨ãƒ©ãƒ¼ã«ãªã‚‰ãªã„ã‚ˆã‚Šã¯ãƒã‚·ã§ã™ã­ï¼

ä¸Šã®ã‚½ãƒ¼ãƒˆã®ä¾‹ã®ã‚ˆã†ãªå ´åˆã§ã‚‚æ´»èºã—ã¦ãã‚Œã¾ã™ï¼
#_
$ ./a.out
- /usr/include/c++/8.2.0/bits/stl_algo.h:4864:
- Error: comparison doesn't meet irreflexive requirements, assert(!(a < a)).
-
- Objects involved in the operation:
-     instance "functor" @ 0x0x7ffdd0ed71b0 {
-       type = main::{lambda(int, int)#1};
-     }
-     iterator::value_type "ordered type" {
-       type = int;
-     }
- Aborted (core dumped)
#_

### `.at(i)`
æ·»å­—ã®ã‚¢ã‚¯ã‚»ã‚¹ã«é–¢ã—ã¦ã¯ï¼Œè¦æ ¼ã§å®šã‚ã‚‰ã‚ŒãŸåˆ¥ã®æ–¹æ³•ãŒå­˜åœ¨ã—ã¾ã™ï¼
#`[sample.cpp]
#include <cstdio>
#include <vector>

int main() {
  std::vector<int> x{1, 2};
  printf("%d\n", x.at(2));
}
#`
#_
$ g++ sample.cpp
$ ./a.out
- terminate called after throwing an instance of 'std::out_of_range'
-   what():  vector::_M_range_check: __n (which is 2) >= this->size() (which is 2)
- Aborted (core dumped)
#_
ã“ã‚Œã¯ã“ã‚Œã§ã‚ã‹ã‚Šã«ãã„ä¸Šï¼Œ`[i]` ã§æ›¸ã‹ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã«ã¯ãŸãã•ã‚“å¤‰æ›´ã‚’åŠ ãˆã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ï¼Œã‚ã¾ã‚Šé©ã—ã¦ã¯ã„ãªã„æ°—ã‚‚ã—ã¾ã™ï¼
ãŸã ï¼Œè¦æ ¼ã§å®šã‚ã‚‰ã‚Œã¦ã„ã‚‹ã¨ã„ã†æ„å‘³ã§ã¯å®‰å¿ƒã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼

### `-fsanitize=undefined`
GCC ã§ã¯å®Ÿè¡Œæ™‚ã®æ¤œå‡ºæ©Ÿèƒ½ã‚‚ç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ï¼ˆãŠä½¿ã„ã® `g++` ãŒã“ã‚Œã«å¯¾å¿œã—ã¦ã„ãªã„ãªã‚‰ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã™ã‚‹ã“ã¨ã‚’ã‚ªã‚¹ã‚¹ãƒ¡ã—ã¾ã™ï¼‰ï¼
ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã‚„é…åˆ—å¢ƒç•Œå¤–å‚ç…§ãªã©ã‚’æ¤œå‡ºã—ã¦ãã‚Œã¾ã™ï¼

#`[sample.cpp]
#include <cstdio>

int main() {
  int x, a[123456]={};
  scanf("%d", &x);
  printf("%d\n", x*x);
  printf("%d\n", x<<x);
  printf("%d\n", a[x]);
}
#`
#_
$ ./a.out
- [1mubsan-overflow.cpp:6:9:[1m[31m runtime error: [1m[0m[1msigned integer overflow: 123456 * 123456 cannot be represented in type 'int'[1m[0m
- -1938485248
- [1mubsan-overflow.cpp:7:19:[1m[31m runtime error: [1m[0m[1mshift exponent 123456 is too large for 32-bit type 'int'[1m[0m
- 123456
- [1mubsan-overflow.cpp:8:21:[1m[31m runtime error: [1m[0m[1mindex 123456 out of bounds for type 'int [123456]'[1m[0m
- [1mubsan-overflow.cpp:8:9:[1m[31m runtime error: [1m[0m[1mload of address 0x7ffc8771b670 with insufficient space for an object of type 'int'[1m[0m
- [1m0x7ffc8771b670:[1m[30m note: [1m[0mpointer points here[1m[0m
-  00 00 00 00  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  d3 08 40 00 00 00 00 00  45 c4 14 cd
- [1m[32m              ^ [1m[0m
- 0
#_

## æ›¸ããŸã„ã“ã¨
- order of evaluation
- `P + J` ãŒ $[0, n]$ ã‚’è¶…ãˆã‚‹ã ã‘ã§ UB ã«ãªã‚‹ã‚„ã¤
